# MZCounter

Diablo 2 Resurrected 전용 카운터 프로그램

게임 플레이 중 화면에 카운트다운 타이머를 표시하여 타이밍을 관리할 수 있는 오버레이 프로그램입니다.

![License](https://img.shields.io/badge/license-Copyright-blue)
![.NET](https://img.shields.io/badge/.NET-9.0-purple)
![Platform](https://img.shields.io/badge/platform-Windows-blue)

## 주요 기능

- ✅ **전역 트리거 키** - 게임 실행 중에도 단축키로 카운터 시작/리셋
- ✅ **커스터마이징 가능한 폰트** - 종류, 크기, 색상 자유롭게 설정
- ✅ **폰트 배경 효과** - 가독성을 위한 테두리/그림자 효과
- ✅ **마우스 위치 추적** - F1 키로 간편하게 카운터 위치 설정
- ✅ **자동 설정 저장** - 프로그램 종료 시 모든 설정 자동 저장
- ✅ **투명 오버레이** - 게임 화면 위에 표시되는 투명 윈도우

## 시스템 요구사항

- **OS**: Windows 10/11
- **Runtime**: .NET 9.0 Runtime ([다운로드](https://dotnet.microsoft.com/download/dotnet/9.0))
- **권장**: 듀얼 모니터 환경

## 다운로드 및 설치

1. [Releases](https://github.com/Lodofin32/D2R_Counter/releases) 페이지에서 최신 버전 다운로드
2. 또는 리포지토리에서 `MZCounter.exe` 다운로드
3. 별도 설치 없이 `MZCounter.exe` 실행

## 사용 방법

### 1. 초기 설정

#### 1-1. 프로그램 실행
- `MZCounter.exe` 더블클릭
- 메인 창이 나타나며 기본적으로 "실행중" 상태

#### 1-2. 설정 창 열기
- 메인 창에서 **"설정 열기"** 버튼 클릭
- 설정 창이 열리면 자동으로 "중지" 상태로 전환
- (트리거 키가 비활성화되어 실수로 카운터가 시작되지 않음)

### 2. 설정 항목 상세

#### 📝 폰트 설정
- **폰트 종류**: 시스템에 설치된 모든 폰트 선택 가능
  - 권장: 굵은 고딕 계열 (맑은 고딕, Noto Sans 등)
- **폰트 크기**: 슬라이더로 조절 (10~200)
  - 권장: 50~100 (게임 해상도에 따라 조절)
- **폰트 색상**: 색상 선택기로 원하는 색상 설정
  - 권장: 흰색(#FFFFFF) 또는 노란색(#FFFF00)

#### 🎨 폰트 배경 설정
- **두께**: 0~10 슬라이더로 조절
  - 0: 배경 효과 없음 (투명)
  - 1-3: 얇은 테두리 (밝은 배경에 적합)
  - 4-7: 중간 테두리 (일반적으로 권장)
  - 8-10: 두꺼운 테두리 (어두운 배경에 적합)
- **색상**: 배경 효과 색상 설정
  - 권장: 검은색(#000000) - 폰트 색상과 대비

#### 📍 카운터 위치 설정

**방법 1: 직접 입력**
- X, Y 좌표를 숫자로 직접 입력
- 화면 왼쪽 상단이 (0, 0)

**방법 2: 마우스 추적 (권장)**
1. **"마우스 추적"** 체크박스 ON
2. 원하는 위치로 마우스 이동
3. 하단에 **"마우스 위치(F1 입력시 설정): x, y"** 실시간 표시
4. 원하는 위치에서 **F1 키** 입력
5. 좌표가 자동으로 입력되고 마우스 추적 자동 OFF

💡 **팁**: 게임 실행 후 카운터를 표시할 위치에서 F1을 누르세요

#### ⏱️ 카운터 설정
- **시작 시간**: 카운트다운 시작 초 (예: 15초)
  - D2R 테러존 리젠: 15초 권장
- **트리거 키**: 카운터를 시작/리셋할 단축키
  - 선택 가능: Space, Enter, F1~F12, A~Z, 0~9 등
  - 권장: Space (게임 중 빠른 접근)

#### 👁️ 미리보기
- 설정한 폰트와 효과를 실시간으로 확인
- 현재 시작 시간(예: 15)이 2자리 포맷으로 표시

#### 💾 저장
- **"확인"** 버튼: 모든 설정 저장 및 적용
- **"취소"** 버튼: 변경사항 취소

### 3. 카운터 실행

#### 3-1. 실행 상태로 전환
- 메인 창에서 **"실행"** 라디오버튼 선택
- 상태 메시지: **"실행중"** (녹색)
- 전역 키보드 후킹 활성화

#### 3-2. 카운터 시작
- 게임 실행 중 설정한 **트리거 키** 입력
- 설정한 위치에 카운트다운 표시
- 형식: 2자리 숫자 (15 → 14 → 13 → ... → 01 → 00)
- 00이 되면 자동으로 사라짐

#### 3-3. 카운터 리셋
- 카운트다운 중 **트리거 키** 다시 입력
- 시작 시간으로 즉시 리셋되며 다시 카운트 시작
- 숨겨진 카운터도 트리거 키로 다시 나타남

#### 3-4. 중지
- 메인 창에서 **"중지"** 라디오버튼 선택
- 카운터 즉시 사라짐
- 트리거 키 비활성화
- 상태 메시지: **"중지됨"** (빨간색)

### 4. 활용 팁

#### 🎮 게임 사용 시
- 📌 **D2R 실행 전** 프로그램을 먼저 실행하고 설정하세요
- 📌 **윈도우 모드** 또는 **테두리 없는 창 모드** 사용 권장
  - 전체화면 모드에서는 오버레이가 보이지 않을 수 있음
- 📌 카운터 위치는 **게임 화면 좌표**
  - 게임 창 위치 변경 시 카운터 위치 재설정 필요
- 📌 듀얼 모니터 사용 시 메인 창은 보조 모니터에, 카운터는 게임 화면에 배치

#### 🎨 시인성 개선
- 📌 폰트 색상은 게임 배경과 **대비되는 색**으로 설정
  - 어두운 배경: 흰색/노란색 폰트
  - 밝은 배경: 검은색/파란색 폰트
- 📌 배경 효과 **5 내외** 설정 시 대부분 배경에서 잘 보임
- 📌 폰트 크기는 게임 해상도에 맞춰 조절
  - 1920x1080: 50~80
  - 2560x1440: 70~100

#### ⚡ 성능 최적화
- 📌 사용하지 않을 때는 **"중지"** 상태로 전환
- 📌 여러 개의 카운터 프로그램 동시 실행 지양

## 구현 기술

### 아키텍처
- **Framework**: WPF (.NET 9.0)
- **Language**: C#
- **UI Library**: Extended.Wpf.Toolkit (ColorPicker)

### 주요 구성 요소

#### 1. GlobalKeyboardHook (전역 키보드 후킹)
```csharp
- Windows API: SetWindowsHookEx, CallNextHookEx
- Low-Level Keyboard Hook (WH_KEYBOARD_LL)
- 게임 실행 중에도 키 입력 감지 가능
```

**동작 원리:**
- Windows의 저수준 키보드 후킹 API 사용
- 시스템 전역에서 키보드 이벤트 감지
- 트리거 키 감지 시 이벤트 발생
- 후킹 해제 시 리소스 자동 해제

#### 2. CountdownWindow (카운트다운 표시)
```csharp
- WindowStyle: None (테두리 없음)
- AllowsTransparency: True (투명 배경)
- Topmost: True (항상 위)
- ShowInTaskbar: False (작업 표시줄 숨김)
```

**동작 원리:**
- DispatcherTimer (1초 간격)로 카운트다운
- FormattedText로 텍스트 렌더링
- DropShadowEffect로 배경 효과 구현
- 0초 도달 시 Hide()로 윈도우 숨김

#### 3. AppSettings (설정 관리)
```csharp
- JSON 직렬화/역직렬화
- 저장 경로: %AppData%\MozaCounter\settings.json
- 자동 저장/불러오기
```

**저장 데이터:**
- 폰트 설정 (종류, 크기, 색상)
- 배경 설정 (두께, 색상)
- 카운터 위치 (X, Y)
- 시작 시간, 트리거 키
- 윈도우 위치 (메인, 설정창)

## 안정성 및 보안

### ✅ 안전한 기술

#### 1. 키보드 후킹의 안전성
- **읽기 전용**: 키 입력을 **감지만** 하고 수정/차단하지 않음
- **필터링**: 설정된 트리거 키만 처리
- **정상적인 API**: Windows 공식 API 사용 (악의적 코드 아님)
- **제한적 범위**: "실행" 상태에서만 활성화

#### 2. 메모리 안전성
- **.NET Managed Code**: 메모리 누수 방지
- **자동 가비지 컬렉션**: 사용하지 않는 리소스 자동 해제
- **IDisposable 패턴**: 키보드 후킹 리소스 명시적 해제

#### 3. 데이터 보안
- **로컬 저장**: 모든 설정은 로컬 PC에만 저장
- **네트워크 통신 없음**: 외부 서버 연결 전혀 없음
- **개인정보 수집 없음**: 사용자 정보 전혀 수집 안 함

### ⚠️ 주의사항

#### 1. 안티치트 프로그램
- **GlobalKeyboardHook**는 시스템 전역 후킹을 사용
- 일부 게임의 안티치트가 **오탐**할 가능성 있음
  - 하지만 읽기 전용이므로 실제 치팅이 아님
  - 게임 메모리를 전혀 건드리지 않음

**대응 방법:**
- D2R은 공식 안티치트가 없어 문제 없음
- 다른 게임 사용 시 주의 필요
- 문제 발생 시 프로그램 종료 후 게임 실행

#### 2. Windows Defender
- 서명되지 않은 exe 파일로 **오탐** 가능
- 안전함: 소스 코드 공개, 악성 코드 없음

**대응 방법:**
```
1. Windows Defender 예외 등록
2. SmartScreen 경고 시 "추가 정보" → "실행" 클릭
3. 소스 코드 확인 후 직접 빌드
```

#### 3. 관리자 권한
- **일반적으로 불필요**
- 일부 환경에서 키보드 후킹이 작동하지 않을 때만 필요

**관리자 권한 실행:**
```
MZCounter.exe 우클릭 → "관리자 권한으로 실행"
```

### 🛡️ 안전성 검증

#### 소스 코드 공개
- ✅ GitHub에 **전체 소스 코드** 공개
- ✅ 누구나 코드 검토 가능
- ✅ 악성 코드 없음을 직접 확인 가능

#### 최소 권한 원칙
- ✅ 필요한 권한만 사용
- ✅ 파일 접근: 설정 파일만
- ✅ 네트워크: 사용 안 함
- ✅ 레지스트리: 수정 안 함

#### 투명성
- ✅ 빌드 방법 공개
- ✅ 의존성 패키지 명시
- ✅ 동작 원리 설명

## 설정 파일

### 저장 위치
```
%AppData%\MozaCounter\settings.json
```

실제 경로 예시:
```
C:\Users\[사용자명]\AppData\Roaming\MozaCounter\settings.json
```

### 설정 초기화
설정을 초기화하려면 위 파일을 삭제하세요.

### 설정 백업
중요한 설정은 `settings.json` 파일을 복사하여 백업하세요.

## 빌드 방법 (개발자용)

### 사전 요구사항
- .NET 9.0 SDK
- Visual Studio 2022 또는 VS Code

### 빌드 명령어

#### 일반 빌드
```bash
dotnet build
```

#### Release 빌드
```bash
dotnet build -c Release
```

#### 단일 실행 파일 생성
```bash
dotnet publish -c Release -r win-x64 --self-contained false -p:PublishSingleFile=true
```
출력: `Release\MZCounter.exe`

### 프로젝트 구조
```
MozaCounter/
├── MainWindow.xaml/cs          # 메인 윈도우
├── FontSettingsWindow.xaml/cs  # 설정 창
├── CountdownWindow.xaml/cs     # 카운트다운 표시
├── GlobalKeyboardHook.cs       # 키보드 후킹
├── AppSettings.cs              # 설정 관리
├── OutlinedTextBlock.cs        # 커스텀 텍스트 컨트롤 (미사용)
└── Resources/                  # 아이콘 리소스
    ├── icon16.png
    ├── icon32.png
    ├── icon64.png
    └── app.ico
```

## 문제 해결

### Q1. 프로그램이 실행되지 않아요
**A1:**
- .NET 9.0 Runtime 설치 확인
  - [다운로드 링크](https://dotnet.microsoft.com/download/dotnet/9.0)
- Windows Defender 예외 등록
- 관리자 권한으로 실행 시도

### Q2. 카운터가 보이지 않아요
**A2:**
- D2R이 **전체화면 모드**인지 확인
  - 윈도우 모드 또는 테두리 없는 창 모드로 변경
- 카운터 위치가 **화면 밖**인지 확인
  - X, Y를 100, 100으로 재설정
- **"실행"** 상태인지 확인
- 트리거 키를 눌러 카운터 시작 확인

### Q3. 트리거 키가 작동하지 않아요
**A3:**
- **"실행"** 상태인지 확인
- 다른 프로그램과 **단축키 충돌** 확인
- **관리자 권한**으로 실행 시도
- 다른 트리거 키로 변경 시도

### Q4. 안티바이러스가 차단해요
**A4:**
- 오탐입니다 (소스 코드 공개, 악성 코드 없음)
- Windows Defender 예외 등록:
  ```
  설정 → 업데이트 및 보안 → Windows 보안 → 바이러스 및 위협 방지
  → 설정 관리 → 제외 추가 → MZCounter.exe 추가
  ```

### Q5. 게임이 느려져요
**A5:**
- 사용하지 않을 때 **"중지"** 상태로 전환
- 폰트 크기를 너무 크게 설정하지 않기
- 다른 오버레이 프로그램과 동시 사용 지양

## 알려진 제한사항

1. **전체화면 모드**: D2R 전체화면 모드에서는 오버레이가 표시되지 않습니다
   - **해결**: 윈도우 모드 또는 테두리 없는 창 모드 사용

2. **다중 모니터**: 게임 창을 다른 모니터로 이동 시 카운터 위치 재설정 필요
   - **해결**: 마우스 추적 기능으로 빠르게 재설정

3. **높은 DPI**: 고해상도 모니터에서 폰트 크기 조절 필요
   - **해결**: 폰트 크기를 100 이상으로 설정

## 향후 계획

- [ ] 다중 카운터 지원
- [ ] 사운드 알림 기능
- [ ] 프리셋 저장/불러오기
- [ ] 자동 업데이트 기능
- [ ] 다국어 지원 (English)

## 라이선스

Copyright© Lodofin32 All rights reserved.

## 기여

버그 리포트 및 기능 제안은 [Issues](https://github.com/Lodofin32/D2R_Counter/issues)에 남겨주세요.

Pull Request도 환영합니다!

## 지원

- **이메일**: [GitHub 프로필 참조]
- **GitHub Issues**: https://github.com/Lodofin32/D2R_Counter/issues

---

**즐거운 D2R 라이프 되세요! 🎮**